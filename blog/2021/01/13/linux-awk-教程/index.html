<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>linux awk 教程 - Minicloudsky&#39;s blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="minicloudsky" />
  <meta name="description" content="用以下信息做示例 $ cat netstat.txt Proto Recv-Q Send-Q Local-Address Foreign-Address State tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN tcp 0 0 coolshell.cn:80 124.205.5.146:18245 TIME_WAIT tcp 0 0 coolshell.cn:80 61.140.101.185:37538 FIN_WAIT2 tcp 0 0 coolshell.cn:80 110.194.134.189:1032 ESTABLISHED tcp 0 0 coolshell.cn:80 123.169.124.111:49809 ESTABLISHED tcp 0 0 coolshell.cn:80 116.234.127.77:11502 FIN_WAIT2 tcp 0 0 coolshell.cn:80 123.169.124.111:49829" />

  <meta name="keywords" content="minicloudsky" />






<meta name="generator" content="Hugo 0.99.1" />


<link rel="canonical" href="http://minicloudsky.github.io/blog/2021/01/13/linux-awk-%E6%95%99%E7%A8%8B/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.8f0ec83f8e157abb4cb8fabe03ebefa49b3959c5be68dc28870652f8a2d07dcd.css" integrity="sha256-jw7IP44VertMuPq&#43;A&#43;vvpJs5WcW&#43;aNwohwZS&#43;KLQfc0=" media="screen" crossorigin="anonymous">







<meta property="og:title" content="linux awk 教程" />
<meta property="og:description" content="用以下信息做示例 $ cat netstat.txt Proto Recv-Q Send-Q Local-Address Foreign-Address State tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN tcp 0 0 coolshell.cn:80 124.205.5.146:18245 TIME_WAIT tcp 0 0 coolshell.cn:80 61.140.101.185:37538 FIN_WAIT2 tcp 0 0 coolshell.cn:80 110.194.134.189:1032 ESTABLISHED tcp 0 0 coolshell.cn:80 123.169.124.111:49809 ESTABLISHED tcp 0 0 coolshell.cn:80 116.234.127.77:11502 FIN_WAIT2 tcp 0 0 coolshell.cn:80 123.169.124.111:49829" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://minicloudsky.github.io/blog/2021/01/13/linux-awk-%E6%95%99%E7%A8%8B/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-01-13T10:54:48+00:00" />
<meta property="article:modified_time" content="2021-01-13T10:54:48+00:00" />

<meta itemprop="name" content="linux awk 教程">
<meta itemprop="description" content="用以下信息做示例 $ cat netstat.txt Proto Recv-Q Send-Q Local-Address Foreign-Address State tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN tcp 0 0 coolshell.cn:80 124.205.5.146:18245 TIME_WAIT tcp 0 0 coolshell.cn:80 61.140.101.185:37538 FIN_WAIT2 tcp 0 0 coolshell.cn:80 110.194.134.189:1032 ESTABLISHED tcp 0 0 coolshell.cn:80 123.169.124.111:49809 ESTABLISHED tcp 0 0 coolshell.cn:80 116.234.127.77:11502 FIN_WAIT2 tcp 0 0 coolshell.cn:80 123.169.124.111:49829"><meta itemprop="datePublished" content="2021-01-13T10:54:48+00:00" />
<meta itemprop="dateModified" content="2021-01-13T10:54:48+00:00" />
<meta itemprop="wordCount" content="3430">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="linux awk 教程"/>
<meta name="twitter:description" content="用以下信息做示例 $ cat netstat.txt Proto Recv-Q Send-Q Local-Address Foreign-Address State tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:80 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:9000 0.0.0.0:* LISTEN tcp 0 0 coolshell.cn:80 124.205.5.146:18245 TIME_WAIT tcp 0 0 coolshell.cn:80 61.140.101.185:37538 FIN_WAIT2 tcp 0 0 coolshell.cn:80 110.194.134.189:1032 ESTABLISHED tcp 0 0 coolshell.cn:80 123.169.124.111:49809 ESTABLISHED tcp 0 0 coolshell.cn:80 116.234.127.77:11502 FIN_WAIT2 tcp 0 0 coolshell.cn:80 123.169.124.111:49829"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Minicloudsky's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/about/">About</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Minicloudsky's blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="http://minicloudsky.github.io/about/">About</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight wallpaper">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">linux awk 教程</h1>
      
      <div class="post-meta">
        <time datetime="2021-01-13" class="post-time">
          2021-01-13
        </time>
        <div class="post-category">
            <a href="http://minicloudsky.github.io/categories/">  </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#用以下信息做示例">用以下信息做示例</a>
      <ul>
        <li><a href="#输出第一列和第四列">输出第一列和第四列</a></li>
        <li><a href="#格式化输出类似于-c语言的printf">格式化输出，类似于 c语言的printf</a></li>
        <li><a href="#过滤">过滤</a></li>
        <li><a href="#需要表头的话可以引入内建变量nr">需要表头的话，可以引入内建变量NR:</a></li>
        <li><a href="#使用行号">使用行号</a></li>
        <li><a href="#指定分隔符">指定分隔符</a></li>
        <li><a href="#使用t-作为分隔符-下面使用了etcpasswd-文件这个文件是以-分隔的">使用\t 作为分隔符 (下面使用了/etc/passwd 文件，这个文件是以: 分隔的)</a></li>
        <li><a href="#字符串匹配">字符串匹配</a></li>
        <li><a href="#awk-可以像-grep-一样去匹配第一行">awk 可以像 grep 一样去匹配第一行</a></li>
        <li><a href="#可以用-fintime-来匹配-fin-或者-time">可以用 &ldquo;/FIN|TIME/&rdquo; 来匹配 FIN 或者 TIME</a></li>
        <li><a href="#模式取反">模式取反</a></li>
        <li><a href="#拆分文件">拆分文件</a></li>
        <li><a href="#把指定的列输出到文件">把指定的列输出到文件</a></li>
        <li><a href="#统计">统计</a></li>
        <li><a href="#环境变量">环境变量</a></li>
        <li><a href="#practice">practice</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="用以下信息做示例">用以下信息做示例</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat netstat.txt
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local-Address          Foreign-Address             State
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:3306           0.0.0.0:*                   LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:80             0.0.0.0:*                   LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:9000         0.0.0.0:*                   LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        124.205.5.146:18245         TIME_WAIT
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        61.140.101.185:37538        FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:1032        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49809       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        116.234.127.77:11502        FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49829       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        183.60.215.36:36970         TIME_WAIT
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">4166</span> coolshell.cn:80        61.148.242.38:30901         ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span> coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:4796        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        183.60.212.163:51082        TIME_WAIT
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span> coolshell.cn:80        208.115.113.92:50601        LAST_ACK
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49840       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        117.136.20.85:50025         FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                  :::*                        LISTEN
</span></span></code></pre></div><h3 id="输出第一列和第四列">输出第一列和第四列</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun ~<span style="color:#f92672">]</span><span style="color:#75715e"># awk &#39;{print $1,$4}&#39; netstat.txt </span>
</span></span><span style="display:flex;"><span>$ 
</span></span><span style="display:flex;"><span>Proto Local-Address
</span></span><span style="display:flex;"><span>tcp 0.0.0.0:3306
</span></span><span style="display:flex;"><span>tcp 0.0.0.0:80
</span></span><span style="display:flex;"><span>tcp 127.0.0.1:9000
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp coolshell.cn:80
</span></span><span style="display:flex;"><span>tcp :::22
</span></span></code></pre></div><p>其中单引号中的被大括号括着的就是awk的语句，注意，其只能被单引号包含。
其中的$1..$n表示第几例。注：$0表示整个行。</p>
<h3 id="格式化输出类似于-c语言的printf">格式化输出，类似于 c语言的printf</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;{printf &#34;%-8s %-8s %-8s %-18s %-22s %-15s\n&#34;,$1,$2,$3,$4,$5,$6}&#39;</span> netstat.txt
</span></span><span style="display:flex;"><span>Proto    Recv-Q   Send-Q   Local-Address      Foreign-Address        State
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        0.0.0.0:3306       0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        0.0.0.0:80         0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        127.0.0.1:9000     0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    124.205.5.146:18245    TIME_WAIT
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    61.140.101.185:37538   FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    110.194.134.189:1032   ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    123.169.124.111:49809  ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    116.234.127.77:11502   FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    123.169.124.111:49829  ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    183.60.215.36:36970    TIME_WAIT
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">4166</span>     coolshell.cn:80    61.148.242.38:30901    ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">1</span>        coolshell.cn:80    124.152.181.209:26825  FIN_WAIT1
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    110.194.134.189:4796   ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    183.60.212.163:51082   TIME_WAIT
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">1</span>        coolshell.cn:80    208.115.113.92:50601   LAST_ACK
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    123.169.124.111:49840  ESTABLISHED
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        coolshell.cn:80    117.136.20.85:50025    FIN_WAIT2
</span></span><span style="display:flex;"><span>tcp      <span style="color:#ae81ff">0</span>        <span style="color:#ae81ff">0</span>        :::22              :::*                   LISTEN
</span></span></code></pre></div><!-- raw HTML omitted -->
<h3 id="过滤">过滤</h3>
<h4 id="过滤第三列的值为0--第六列的值为-listen">过滤第三列的值为0 &amp;&amp; 第六列的值为 LISTEN</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;$3==0 &amp;&amp; $6==&#34;LISTEN&#34; &#39;</span> netstat.txt
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:3306               0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:80                 0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:9000             0.0.0.0:*              LISTEN
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                      :::*                   LISTEN
</span></span></code></pre></div><p>== 为比较运算符，其他比较运算符: !=,&gt;,&lt;,&gt;=,&lt;=</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39; $3&gt;0 {print $0}&#39;</span> netstat.txt
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local-Address          Foreign-Address             State
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">4166</span> coolshell.cn:80        61.148.242.38:30901         ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span> coolshell.cn:80        124.152.181.209:26825       FIN_WAIT1
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span> coolshell.cn:80        208.115.113.92:50601        LAST_ACK
</span></span></code></pre></div><h3 id="需要表头的话可以引入内建变量nr">需要表头的话，可以引入内建变量NR:</h3>
<p>$ awk &lsquo;$3==0 &amp;&amp; $6==&ldquo;LISTEN&rdquo; || NR==1 &rsquo; netstat.txt
Proto Recv-Q Send-Q Local-Address          Foreign-Address             State
tcp        0      0 0.0.0.0:3306           0.0.0.0:*                   LISTEN
tcp        0      0 0.0.0.0:80             0.0.0.0:*                   LISTEN
tcp        0      0 127.0.0.1:9000         0.0.0.0:*                   LISTEN
tcp        0      0 :::22                  :::*                        LISTEN</p>
<h4 id="加上格式化输出">加上格式化输出</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;$3==0 &amp;&amp; $6==&#34;LISTEN&#34; || NR==1 {printf &#34;%-20s %-20s %s\n&#34;,$4,$5,$6}&#39;</span> netstat.txt
</span></span><span style="display:flex;"><span>Local-Address        Foreign-Address      State
</span></span><span style="display:flex;"><span>0.0.0.0:3306         0.0.0.0:*            LISTEN
</span></span><span style="display:flex;"><span>0.0.0.0:80           0.0.0.0:*            LISTEN
</span></span><span style="display:flex;"><span>127.0.0.1:9000       0.0.0.0:*            LISTEN
</span></span><span style="display:flex;"><span>:::22                :::*                 LISTEN
</span></span></code></pre></div><p>awk 内建变量</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0</td>
<td>当前记录(这个变量存放着整个行的内容)</td>
</tr>
<tr>
<td>$1-$n</td>
<td>当前记录的第n个字段，字段间由 FS分隔</td>
</tr>
<tr>
<td>FS</td>
<td>输入字段分隔符，默认是空格或者tab</td>
</tr>
<tr>
<td>NF</td>
<td>当前记录中的字段个数，就是有多少列</td>
</tr>
<tr>
<td>NR</td>
<td>已经读出的记录数，就是行号，从1开始，如果有多个文件的话，这个值也是不断累加中</td>
</tr>
<tr>
<td>FNR</td>
<td>当前记录数，与NR不同的是，这个值是各个文件自己的行号</td>
</tr>
<tr>
<td>RS</td>
<td>输入的记录分隔符，默认为换行符</td>
</tr>
<tr>
<td>OFS</td>
<td>输出字段分隔符，默认也是空格</td>
</tr>
<tr>
<td>ORS</td>
<td>输出的记录分隔符，默认为换行符</td>
</tr>
<tr>
<td>FILENAME</td>
<td>当前输入文件的名字</td>
</tr>
</tbody>
</table>
<h3 id="使用行号">使用行号</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;$3==0 &amp;&amp; $6==&#34;ESTABLISHED&#34; || NR==1 {printf &#34;%02s %s %-20s %-20s %s\n&#34;,NR, FNR, $4,$5,$6}&#39;</span> netstat.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">01</span> <span style="color:#ae81ff">1</span> Local-Address        Foreign-Address      State
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">07</span> <span style="color:#ae81ff">7</span> coolshell.cn:80      110.194.134.189:1032 ESTABLISHED
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">08</span> <span style="color:#ae81ff">8</span> coolshell.cn:80      123.169.124.111:49809 ESTABLISHED
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">10</span> <span style="color:#ae81ff">10</span> coolshell.cn:80      123.169.124.111:49829 ESTABLISHED
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">14</span> <span style="color:#ae81ff">14</span> coolshell.cn:80      110.194.134.189:4796 ESTABLISHED
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">17</span> <span style="color:#ae81ff">17</span> coolshell.cn:80      123.169.124.111:49840 ESTABLISHED
</span></span></code></pre></div><h3 id="指定分隔符">指定分隔符</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$  awk  <span style="color:#e6db74">&#39;BEGIN{FS=&#34;:&#34;} {print $1,$3,$6}&#39;</span> /etc/passwd
</span></span><span style="display:flex;"><span>root <span style="color:#ae81ff">0</span> /root
</span></span><span style="display:flex;"><span>bin <span style="color:#ae81ff">1</span> /bin
</span></span><span style="display:flex;"><span>daemon <span style="color:#ae81ff">2</span> /sbin
</span></span><span style="display:flex;"><span>adm <span style="color:#ae81ff">3</span> /var/adm
</span></span><span style="display:flex;"><span>lp <span style="color:#ae81ff">4</span> /var/spool/lpd
</span></span><span style="display:flex;"><span>sync <span style="color:#ae81ff">5</span> /sbin
</span></span><span style="display:flex;"><span>shutdown <span style="color:#ae81ff">6</span> /sbin
</span></span><span style="display:flex;"><span>halt <span style="color:#ae81ff">7</span> /sbin
</span></span></code></pre></div><p>上面的命令也等价于：（-F的意思就是指定分隔符）</p>
<p><code>$ awk  -F: '{print $1,$3,$6}' /etc/passwd</code>
注：如果你要指定多个分隔符，你可以这样来：
<code>awk -F '[;:]'</code></p>
<h3 id="使用t-作为分隔符-下面使用了etcpasswd-文件这个文件是以-分隔的">使用\t 作为分隔符 (下面使用了/etc/passwd 文件，这个文件是以: 分隔的)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun ~<span style="color:#f92672">]</span><span style="color:#75715e"># awk -F: &#39;{print $1,$3,$6} OFS=&#34;\t&#34; &#39; /etc/passwd</span>
</span></span><span style="display:flex;"><span>root <span style="color:#ae81ff">0</span> /root
</span></span><span style="display:flex;"><span>root❌0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>bin	1	/bin
</span></span><span style="display:flex;"><span>bin❌1:1:bin:/bin:/sbin/nologin
</span></span><span style="display:flex;"><span>daemon	2	/sbin
</span></span><span style="display:flex;"><span>daemon❌2:2:daemon:/sbin:/sbin/nologin
</span></span><span style="display:flex;"><span>adm	3	/var/adm
</span></span><span style="display:flex;"><span>adm❌3:4:adm:/var/adm:/sbin/nologin
</span></span><span style="display:flex;"><span>lp	4	/var/spool/lpd
</span></span><span style="display:flex;"><span>lp❌4:7:lp:/var/spool/lpd:/sbin/nologin
</span></span><span style="display:flex;"><span>sync	5	/sbin
</span></span><span style="display:flex;"><span>sync❌5:0:sync:/sbin:/bin/sync
</span></span><span style="display:flex;"><span>shutdown	6	/sbin
</span></span><span style="display:flex;"><span>shutdown❌6:0:shutdown:/sbin:/sbin/shutdown
</span></span><span style="display:flex;"><span>halt	7	/sbin
</span></span><span style="display:flex;"><span>halt❌7:0:halt:/sbin:/sbin/halt
</span></span><span style="display:flex;"><span>mail	8	/var/spool/mail
</span></span><span style="display:flex;"><span>mail❌8:12:mail:/var/spool/mail:/sbin/nologin
</span></span><span style="display:flex;"><span>operator	11	/root
</span></span><span style="display:flex;"><span>operator❌11:0:operator:/root:/sbin/nologin
</span></span><span style="display:flex;"><span>games	12	/usr/games
</span></span><span style="display:flex;"><span>games❌12💯games:/usr/games:/sbin/nologin
</span></span><span style="display:flex;"><span>ftp	14	/var/ftp
</span></span><span style="display:flex;"><span>ftp❌14:50:FTP User:/var/ftp:/sbin/nologin
</span></span><span style="display:flex;"><span>nobody	99	/
</span></span><span style="display:flex;"><span>nobody❌99:99:Nobody:/:/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-network	192	/
</span></span><span style="display:flex;"><span>systemd-network❌192:192:systemd Network Management:/:/sbin/nologin
</span></span><span style="display:flex;"><span>dbus	81	/
</span></span><span style="display:flex;"><span>dbus❌81:81:System message bus:/:/sbin/nologin
</span></span><span style="display:flex;"><span>polkitd	999	/
</span></span><span style="display:flex;"><span>polkitd❌999:998:User <span style="color:#66d9ef">for</span> polkitd:/:/sbin/nologin
</span></span><span style="display:flex;"><span>sshd	74	/var/empty/sshd
</span></span><span style="display:flex;"><span>sshd❌74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
</span></span><span style="display:flex;"><span>postfix	89	/var/spool/postfix
</span></span><span style="display:flex;"><span>postfix❌89:89::/var/spool/postfix:/sbin/nologin
</span></span><span style="display:flex;"><span>chrony	998	/var/lib/chrony
</span></span><span style="display:flex;"><span>chrony❌998:996::/var/lib/chrony:/sbin/nologin
</span></span><span style="display:flex;"><span>nscd	28	/
</span></span><span style="display:flex;"><span>nscd❌28:28:NSCD Daemon:/:/sbin/nologin
</span></span><span style="display:flex;"><span>tcpdump	72	/
</span></span><span style="display:flex;"><span>tcpdump❌72:72::/:/sbin/nologin
</span></span><span style="display:flex;"><span>rpc	32	/var/lib/rpcbind
</span></span><span style="display:flex;"><span>rpc❌32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin
</span></span><span style="display:flex;"><span>rpcuser	29	/var/lib/nfs
</span></span><span style="display:flex;"><span>rpcuser❌29:29:RPC Service User:/var/lib/nfs:/sbin/nologin
</span></span><span style="display:flex;"><span>nfsnobody	65534	/var/lib/nfs
</span></span><span style="display:flex;"><span>nfsnobody❌65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin
</span></span><span style="display:flex;"><span>avahi	70	/var/run/avahi-daemon
</span></span><span style="display:flex;"><span>avahi❌70:70:Avahi mDNS/DNS-SD Stack:/var/run/avahi-daemon:/sbin/nologin
</span></span><span style="display:flex;"><span>tss	59	/dev/null
</span></span><span style="display:flex;"><span>tss❌59:59:Account used by the trousers package to sandbox the tcsd daemon:/dev/null:/sbin/nologin
</span></span><span style="display:flex;"><span>nginx	997	/var/lib/nginx
</span></span><span style="display:flex;"><span>nginx❌997:994:Nginx web server:/var/lib/nginx:/sbin/nologin
</span></span><span style="display:flex;"><span>fsg	1000	/home/fsg
</span></span><span style="display:flex;"><span>fsg❌1000:1000::/home/fsg:/bin/bash
</span></span><span style="display:flex;"><span>hadoop	1001	/home/hadoop
</span></span><span style="display:flex;"><span>hadoop❌1001:1001::/home/hadoop:/bin/bash
</span></span><span style="display:flex;"><span>dockerroot	996	/var/lib/docker
</span></span><span style="display:flex;"><span>dockerroot❌996:993:Docker User:/var/lib/docker:/sbin/nologin
</span></span><span style="display:flex;"><span>dolphinscheduler	1002	/home/dolphinscheduler
</span></span><span style="display:flex;"><span>dolphinscheduler❌1002:1002::/home/dolphinscheduler:/bin/bash
</span></span></code></pre></div><h3 id="字符串匹配">字符串匹配</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ awk <span style="color:#e6db74">&#39;$6 ~ /FIN/ || NR==1 {print NR,$4,$5,$6}&#39;</span> OFS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span> netstat.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>       Local-Address   Foreign-Address State
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span>       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">13</span>      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span>      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ $ awk <span style="color:#e6db74">&#39;$6 ~ /WAIT/ || NR==1 {print NR,$4,$5,$6}&#39;</span> OFS<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;\t&#34;</span> netstat.txt
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>       Local-Address   Foreign-Address State
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span>       coolshell.cn:80 124.205.5.146:18245     TIME_WAIT
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">6</span>       coolshell.cn:80 61.140.101.185:37538    FIN_WAIT2
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span>       coolshell.cn:80 116.234.127.77:11502    FIN_WAIT2
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">11</span>      coolshell.cn:80 183.60.215.36:36970     TIME_WAIT
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">13</span>      coolshell.cn:80 124.152.181.209:26825   FIN_WAIT1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">15</span>      coolshell.cn:80 183.60.212.163:51082    TIME_WAIT
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">18</span>      coolshell.cn:80 117.136.20.85:50025     FIN_WAIT2
</span></span></code></pre></div><p>上面的第一个示例匹配FIN状态， 第二个示例匹配WAIT字样的状态。其实 ~ 表示模式开始。/ /中是模式。这就是一个正则表达式的匹配。</p>
<h3 id="awk-可以像-grep-一样去匹配第一行">awk 可以像 grep 一样去匹配第一行</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun ~<span style="color:#f92672">]</span><span style="color:#75715e"># awk &#39;/ESTABLISHED/&#39; netstat.txt </span>
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:1032        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49809       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49829       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">4166</span> coolshell.cn:80        61.148.242.38:30901         ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:4796        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49840       ESTABLISHED
</span></span></code></pre></div><h3 id="可以用-fintime-来匹配-fin-或者-time">可以用 &ldquo;/FIN|TIME/&rdquo; 来匹配 FIN 或者 TIME</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun ~<span style="color:#f92672">]</span><span style="color:#75715e"># awk &#39;$6 ~ /FIN|TIME/ || NR==1 {print NR,$4,$5,$6}&#39; OFS=&#34;\t&#34;   netstat.txt</span>
</span></span><span style="display:flex;"><span>1			
</span></span><span style="display:flex;"><span>6	coolshell.cn:80	124.205.5.146:18245	TIME_WAIT
</span></span><span style="display:flex;"><span>7	coolshell.cn:80	61.140.101.185:37538	FIN_WAIT2
</span></span><span style="display:flex;"><span>10	coolshell.cn:80	116.234.127.77:11502	FIN_WAIT2
</span></span><span style="display:flex;"><span>12	coolshell.cn:80	183.60.215.36:36970	TIME_WAIT
</span></span><span style="display:flex;"><span>14	coolshell.cn:80	124.152.181.209:26825	FIN_WAIT1
</span></span><span style="display:flex;"><span>16	coolshell.cn:80	183.60.212.163:51082	TIME_WAIT
</span></span><span style="display:flex;"><span>19	coolshell.cn:80	117.136.20.85:50025	FIN_WAIT2
</span></span></code></pre></div><h3 id="模式取反">模式取反</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun ~<span style="color:#f92672">]</span><span style="color:#75715e">#  awk &#39;$6 !~ /WAIT/ || NR==1 {print NR,$4,$5,$6}&#39; OFS=&#34;\t&#34; netstat.txt</span>
</span></span><span style="display:flex;"><span>1			
</span></span><span style="display:flex;"><span>2	Local-Address	Foreign-Address	State
</span></span><span style="display:flex;"><span>3	0.0.0.0:3306	0.0.0.0:*	LISTEN
</span></span><span style="display:flex;"><span>4	0.0.0.0:80	0.0.0.0:*	LISTEN
</span></span><span style="display:flex;"><span>5	127.0.0.1:9000	0.0.0.0:*	LISTEN
</span></span><span style="display:flex;"><span>8	coolshell.cn:80	110.194.134.189:1032	ESTABLISHED
</span></span><span style="display:flex;"><span>9	coolshell.cn:80	123.169.124.111:49809	ESTABLISHED
</span></span><span style="display:flex;"><span>11	coolshell.cn:80	123.169.124.111:49829	ESTABLISHED
</span></span><span style="display:flex;"><span>13	coolshell.cn:80	61.148.242.38:30901	ESTABLISHED
</span></span><span style="display:flex;"><span>15	coolshell.cn:80	110.194.134.189:4796	ESTABLISHED
</span></span><span style="display:flex;"><span>17	coolshell.cn:80	208.115.113.92:50601	LAST_ACK
</span></span><span style="display:flex;"><span>18	coolshell.cn:80	123.169.124.111:49840	ESTABLISHED
</span></span><span style="display:flex;"><span>20	:::22	:::*	LISTEN
</span></span></code></pre></div><p>或是：
<code>awk '!/WAIT/' netstat.txt</code></p>
<h3 id="拆分文件">拆分文件</h3>
<p>awk 通过重定向拆分文件，下面按第6例分隔文件(其中的NR!=1表示不处理表头)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># awk &#39;NR!=1{print &gt; $6}&#39; netstat.txt </span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
</span></span><span style="display:flex;"><span>ESTABLISHED  FIN_WAIT1  FIN_WAIT2  LAST_ACK  LISTEN  netstat.txt  State  TIME_WAIT
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># cat ESTABLISHED </span>
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:1032        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49809       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49829       ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>   <span style="color:#ae81ff">4166</span> coolshell.cn:80        61.148.242.38:30901         ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        110.194.134.189:4796        ESTABLISHED
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> coolshell.cn:80        123.169.124.111:49840       ESTABLISHED
</span></span></code></pre></div><h3 id="把指定的列输出到文件">把指定的列输出到文件</h3>
<p>awk &lsquo;NR!=1{print $4,$5 &gt; $6}&rsquo; netstat.txt
再复杂一点：（注意其中的if-else-if语句，可见awk其实是个脚本解释器）
awk &lsquo;NR!=1{if($6 ~ /TIME|ESTABLISHED/) print &gt; &ldquo;1.txt&rdquo;;
else if($6 ~ /LISTEN/) print &gt; &ldquo;2.txt&rdquo;;
else print &gt; &ldquo;3.txt&rdquo; }&rsquo; netstat.txt</p>
<h3 id="统计">统计</h3>
<p>计算所有的 c 文件，cpp文件和 h 文件的文件大小总和
ls -l  *.cpp *.c *.h | awk &lsquo;{sum+=$5} END {print sum}&rsquo;</p>
<p>统计各个 connection 状态
awk &lsquo;NR!=1{a[$6]++;} END {for (i in a) print i &ldquo;, &quot; a[i];}&rsquo; netstat.txt</p>
<p>统计各个用户占用的内存</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span> <span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e">#  ps aux | awk &#39;NR!=1{a[$1]+=$6;} END { for(i in a) print i &#34;, &#34; a[i]&#34;KB&#34;;}&#39;rpc, 1140KB</span>
</span></span><span style="display:flex;"><span>chrony, 1556KB
</span></span><span style="display:flex;"><span>polkitd, 604816KB
</span></span><span style="display:flex;"><span>dbus, 1920KB
</span></span><span style="display:flex;"><span>avahi, 2064KB
</span></span><span style="display:flex;"><span>root, 981756KB
</span></span></code></pre></div><h4 id="awk-脚本">awk 脚本</h4>
<p>在上面我们可以看到一个END关键字。END的意思是“处理完所有的行的标识”，即然说到了END就有必要介绍一下BEGIN，这两个关键字意味着执行前和执行后的意思，语法如下：</p>
<p>BEGIN{ 这里面放的是执行前的语句 }
END {这里面放的是处理完所有的行后要执行的语句 }
{这里面放的是处理每一行时要执行的语句}</p>
<p>假设有这么一个文件（学生成绩表）:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># cat score.txt </span>
</span></span><span style="display:flex;"><span>Marry   <span style="color:#ae81ff">2143</span> <span style="color:#ae81ff">78</span> <span style="color:#ae81ff">84</span> <span style="color:#ae81ff">77</span>
</span></span><span style="display:flex;"><span>Jack    <span style="color:#ae81ff">2321</span> <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">78</span> <span style="color:#ae81ff">45</span>
</span></span><span style="display:flex;"><span>Tom     <span style="color:#ae81ff">2122</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">77</span> <span style="color:#ae81ff">71</span>
</span></span><span style="display:flex;"><span>Mike    <span style="color:#ae81ff">2537</span> <span style="color:#ae81ff">87</span> <span style="color:#ae81ff">97</span> <span style="color:#ae81ff">95</span>
</span></span><span style="display:flex;"><span>Bob     <span style="color:#ae81ff">2415</span> <span style="color:#ae81ff">40</span> <span style="color:#ae81ff">57</span> <span style="color:#ae81ff">62</span>
</span></span></code></pre></div><p>awk脚本如下:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat cal.awk
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/awk -f</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#运行前</span>
</span></span><span style="display:flex;"><span>BEGIN <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    math <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    english <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    computer <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL\n&#34;</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;---------------------------------------------\n&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#运行中</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    math<span style="color:#f92672">+=</span>$3
</span></span><span style="display:flex;"><span>    english<span style="color:#f92672">+=</span>$4
</span></span><span style="display:flex;"><span>    computer<span style="color:#f92672">+=</span>$5
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;%-6s %-6s %4d %8d %8d %8d\n&#34;</span>, $1, $2, $3,$4,$5, $3+$4+$5
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#运行后</span>
</span></span><span style="display:flex;"><span>END <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;---------------------------------------------\n&#34;</span>
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;  TOTAL:%10d %8d %8d \n&#34;</span>, math, english, computer
</span></span><span style="display:flex;"><span>    printf <span style="color:#e6db74">&#34;AVERAGE:%10.2f %8.2f %8.2f\n&#34;</span>, math/NR, english/NR, computer/NR
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span></code></pre></div><p>看下执行结果</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># awk -f cal.awk score.txt </span>
</span></span><span style="display:flex;"><span>NAME    NO.   MATH  ENGLISH  COMPUTER   TOTAL
</span></span><span style="display:flex;"><span>---------------------------------------------
</span></span><span style="display:flex;"><span>Marry  <span style="color:#ae81ff">2143</span>     <span style="color:#ae81ff">78</span>       <span style="color:#ae81ff">84</span>       <span style="color:#ae81ff">77</span>      <span style="color:#ae81ff">239</span>
</span></span><span style="display:flex;"><span>Jack   <span style="color:#ae81ff">2321</span>     <span style="color:#ae81ff">66</span>       <span style="color:#ae81ff">78</span>       <span style="color:#ae81ff">45</span>      <span style="color:#ae81ff">189</span>
</span></span><span style="display:flex;"><span>Tom    <span style="color:#ae81ff">2122</span>     <span style="color:#ae81ff">48</span>       <span style="color:#ae81ff">77</span>       <span style="color:#ae81ff">71</span>      <span style="color:#ae81ff">196</span>
</span></span><span style="display:flex;"><span>Mike   <span style="color:#ae81ff">2537</span>     <span style="color:#ae81ff">87</span>       <span style="color:#ae81ff">97</span>       <span style="color:#ae81ff">95</span>      <span style="color:#ae81ff">279</span>
</span></span><span style="display:flex;"><span>Bob    <span style="color:#ae81ff">2415</span>     <span style="color:#ae81ff">40</span>       <span style="color:#ae81ff">57</span>       <span style="color:#ae81ff">62</span>      <span style="color:#ae81ff">159</span>
</span></span><span style="display:flex;"><span>---------------------------------------------
</span></span><span style="display:flex;"><span>  TOTAL:       <span style="color:#ae81ff">319</span>      <span style="color:#ae81ff">393</span>      <span style="color:#ae81ff">350</span> 
</span></span><span style="display:flex;"><span>AVERAGE:     63.80    78.60    70.00
</span></span></code></pre></div><h3 id="环境变量">环境变量</h3>
<p>和环境变量交互(使用-v参数和ENVIRON，使用ENVIRON的环境变量需要 export)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># x=5</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># y=10</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># export y</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># echo $x $y</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">5</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@aliyun awk<span style="color:#f92672">]</span><span style="color:#75715e"># awk -v val=$x &#39;{print $1, $2, $3, $4+val, $5+ENVIRON[&#34;y&#34;]}&#39; OFS=&#34;\t&#34; score.txt</span>
</span></span><span style="display:flex;"><span>Marry	2143	78	89	<span style="color:#ae81ff">87</span>
</span></span><span style="display:flex;"><span>Jack	2321	66	83	<span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>Tom	2122	48	82	<span style="color:#ae81ff">81</span>
</span></span><span style="display:flex;"><span>Mike	2537	87	102	<span style="color:#ae81ff">105</span>
</span></span><span style="display:flex;"><span>Bob	2415	40	62	<span style="color:#ae81ff">72</span>
</span></span></code></pre></div><h3 id="practice">practice</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e">#从file文件中找出长度大于80的行</span>
</span></span><span style="display:flex;"><span>awk <span style="color:#e6db74">&#39;length&gt;80&#39;</span> file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#按连接数查看客户端IP</span>
</span></span><span style="display:flex;"><span>netstat -ntu | awk <span style="color:#e6db74">&#39;{print $5}&#39;</span> | cut -d: -f1 | sort | uniq -c | sort -nr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#打印99乘法表</span>
</span></span><span style="display:flex;"><span>seq <span style="color:#ae81ff">9</span> | sed <span style="color:#e6db74">&#39;H;g&#39;</span> | awk -v RS<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#e6db74">&#39;{for(i=1;i&lt;=NF;i++)printf(&#34;%dx%d=%d%s&#34;, i, NR, i*NR, i==NR?&#34;\n&#34;:&#34;\t&#34;)}&#39;</span> 
</span></span></code></pre></div><p>内建变量，参看：http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din-Variables
流控方面，参看：http://www.gnu.org/software/gawk/manual/gawk.html#Statements
内建函数，参看：http://www.gnu.org/software/gawk/manual/gawk.html#Built_002din
正则表达式，参看：http://www.gnu.org/software/gawk/manual/gawk.html#Regexp</p>

    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">minicloudsky</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
      2021-01-13
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
          <a class="prev" href="/blog/2021/01/13/dataworks%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">dataworks学习笔记</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/blog/2020/12/17/java-%E5%AE%9E%E7%8E%B0%E5%9B%9B%E8%88%8D%E5%85%AD%E5%85%A5/">
            <span class="next-text nav-default">java 实现四舍六入</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  

    

  

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:minicloudsky@email.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="http://github.com/minicloudsky" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="http://minicloudsky.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2017 -
    2022
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        minicloudsky
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  

















</body>
</html>
